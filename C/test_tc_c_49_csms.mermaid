sequenceDiagram
    participant CS as Charging Station (OCTT)
    participant CSMS as CSMS (System Under Test)

    Note over CS, CSMS: Test Case: TC_C_49_CSMS
    Note over CS, CSMS: Stop Transaction with a Master Pass - Without UI
    Note over CS, CSMS: Use Case: C16 | Requirement: C16_FR_02

    Note over CS, CSMS: Prerequisites
    Note over CS, CSMS: State is EnergyTransferStarted for EVSE 1 with valid_idtoken
    Note over CS, CSMS: State is EnergyTransferStarted for EVSE 2 with valid_idtoken2
    Note over CS, CSMS: An idToken with MasterPass as GroupId is configured

    CS->>CSMS: AuthorizeRequest
    Note right of CS: idToken.idToken: [Configured masterpass_idtoken_idtoken]<br/>idToken.type: [Configured masterpass_idtoken_type]

    CSMS-->>CS: AuthorizeResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: masterPassGroupId

    Note over CS, CSMS: For EVSE 1 (stop with original transaction idToken)
    CS->>CSMS: TransactionEventRequest
    Note right of CS: transactionInfo.stoppedReason: MasterPass<br/>idToken.idToken: [Configured valid_idtoken_idtoken]<br/>idToken.type: [Configured valid_idtoken_type]<br/>eventType: Ended

    CSMS-->>CS: TransactionEventResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: masterPassGroupId

    Note over CS, CSMS: For EVSE 2 (stop with original transaction idToken2)
    CS->>CSMS: TransactionEventRequest
    Note right of CS: transactionInfo.stoppedReason: MasterPass<br/>idToken.idToken: [Configured valid_idtoken2_idtoken]<br/>idToken.type: [Configured valid_idtoken2_type]<br/>eventType: Ended

    CSMS-->>CS: TransactionEventResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: masterPassGroupId

    Note over CS, CSMS: Without UI: CS uses original transaction idTokens (not masterpass)
    Note over CS, CSMS: All transactions stopped, cables unlocked
