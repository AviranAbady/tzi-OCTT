sequenceDiagram
    participant CS as Charging Station (OCTT)
    participant CSMS as CSMS (System Under Test)

    Note over CS,CSMS: Test Case: TC_A_08_CSMS
    Note over CS,CSMS: TLS - Client-side certificate - Invalid certificate
    Note over CS,CSMS: Prerequisite: CSMS supports security profile 3

    CS->>CSMS: 1. Initiate TLS handshake (Client Hello)
    CSMS-->>CS: 2. Server Hello with server certificate

    Note over CS: 3. OCTT performs:<br/>Send <Invalid client certificate><br/>Client Key Exchange<br/>Certificate verify<br/>Change Cipher Spec<br/>Finished

    CSMS--xCS: 4. CSMS deems client certificate invalid<br/>and terminates connection

    Note over CS,CSMS: First connection rejected (invalid client cert)

    CS->>CSMS: 5. Initiate TLS handshake (Client Hello)
    CSMS-->>CS: 6. Server Hello with server certificate

    Note over CS: 7. OCTT performs:<br/>Send <Valid client certificate><br/>Client Key Exchange<br/>Certificate verify<br/>Change Cipher Spec<br/>Finished

    Note over CSMS: 8. CSMS performs:<br/>Change Cipher Spec<br/>Finished

    Note over CS,CSMS: TLS Handshake Complete

    CS->>CSMS: 9. HTTP Upgrade Request
    CSMS-->>CS: 10. Upgrade to (secured) WebSocket connection

    CS->>CSMS: 11. BootNotificationRequest (reason: PowerUp)
    CSMS-->>CS: 12. BootNotificationResponse (status: Accepted)
    Note over CSMS: Validation: status must be Accepted

    CS->>CSMS: 13. StatusNotificationRequest (connectorStatus: Available)
    CSMS-->>CS: Response

    CS->>CSMS: 13. NotifyEventRequest
    Note right of CS: trigger: Delta<br/>actualValue: "Available"<br/>component.name: "Connector"<br/>variable.name: "AvailabilityState"
    CSMS-->>CS: 14. Response
