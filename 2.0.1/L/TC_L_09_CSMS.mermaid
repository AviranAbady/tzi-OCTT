sequenceDiagram
    participant CS as Charging Station (OCTT)
    participant CSMS as CSMS (System Under Test)

    Note over CS,CSMS: Test Case: TC_L_09_CSMS
    Note over CS,CSMS: Secure Firmware Update - InstallationFailed

    CSMS->>CS: 1. UpdateFirmwareRequest
    Note left of CSMS: requestId<br/>firmware.location<br/>firmware.retrieveDateTime<br/>firmware.signingCertificate<br/>firmware.signature

    CS-->>CSMS: 2. UpdateFirmwareResponse
    Note right of CS: status = Accepted

    CS->>CSMS: 3. FirmwareStatusNotificationRequest
    Note right of CS: status = Downloading

    CSMS-->>CS: 4. FirmwareStatusNotificationResponse

    CS->>CSMS: 5. FirmwareStatusNotificationRequest
    Note right of CS: status = Downloaded

    CSMS-->>CS: 6. FirmwareStatusNotificationResponse

    CS->>CSMS: 7. FirmwareStatusNotificationRequest
    Note right of CS: status = SignatureVerified

    CSMS-->>CS: 8. FirmwareStatusNotificationResponse

    CS->>CSMS: 9. FirmwareStatusNotificationRequest
    Note right of CS: status = Installing

    CSMS-->>CS: 10. FirmwareStatusNotificationResponse

    CS->>CSMS: 11. FirmwareStatusNotificationRequest
    Note right of CS: status = InstallRebooting

    CSMS-->>CS: 12. FirmwareStatusNotificationResponse

    Note over CS,CSMS: CS reboots

    CS->>CSMS: 13. BootNotificationRequest
    Note right of CS: reason = FirmwareUpdate

    CSMS-->>CS: 14. BootNotificationResponse
    Note left of CSMS: status = Accepted

    CS->>CSMS: 15. StatusNotificationRequest
    Note right of CS: connectorStatus = Available

    CSMS-->>CS: 16. StatusNotificationResponse

    CS->>CSMS: 15b. NotifyEventRequest
    Note right of CS: trigger = Delta<br/>actualValue = "Available"<br/>component.name = "Connector"<br/>variable.name = "AvailabilityState"

    CSMS-->>CS: 16b. NotifyEventResponse

    CS->>CSMS: 17. FirmwareStatusNotificationRequest
    Note right of CS: status = InstallationFailed

    CSMS-->>CS: 18. FirmwareStatusNotificationResponse
