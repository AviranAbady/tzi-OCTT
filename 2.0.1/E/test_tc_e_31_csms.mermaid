sequenceDiagram
    participant CS as Charging Station (OCTT)
    participant CSMS as CSMS (System Under Test)

    Note over CS,CSMS: TC_E_31 - Check Transaction status - ended - with message in queue
    Note over CS,CSMS: Use case: E14 | Requirements: E14.FR.03, E14.FR.04
    Note over CS,CSMS: Before: Reusable State EnergyTransferStarted

    CS->>CS: Close WebSocket connection
    Note over CS,CSMS: Reconnect to CSMS
    CS->>CSMS: WebSocket reconnect

    CS->>CSMS: StatusNotificationRequest [connectorStatus=Available]
    CSMS-->>CS: StatusNotificationResponse

    CS->>CSMS: TransactionEventRequest [eventType=Ended, offline=true, triggerReason=EVCommunicationLost, chargingState=Idle, stoppedReason=EVDisconnected, seqNo=<skips 2 values>]
    CSMS-->>CS: TransactionEventResponse

    CSMS->>CS: GetTransactionStatusRequest [transactionId=<generated transactionId>]
    CS-->>CSMS: GetTransactionStatusResponse [ongoingIndicator=false, messagesInQueue=true]

    CS->>CSMS: TransactionEventRequest [eventType=Updated, triggerReason=StopAuthorized, offline=true, seqNo=<first skipped>]
    CSMS-->>CS: TransactionEventResponse

    CS->>CSMS: TransactionEventRequest [eventType=Updated, triggerReason=ChargingStateChanged, chargingState=EVConnected, offline=true, seqNo=<second skipped>]
    CSMS-->>CS: TransactionEventResponse
