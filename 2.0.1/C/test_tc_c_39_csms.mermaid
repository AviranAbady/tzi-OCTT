sequenceDiagram
    participant CS as Charging Station (OCTT)
    participant CSMS as CSMS (System Under Test)

    Note over CS, CSMS: Test Case: TC_C_39_CSMS
    Note over CS, CSMS: Authorization by GroupId - Success
    Note over CS, CSMS: Use Case: C09 | Requirements: C09_FR_02, C09_FR_03

    Note over CS, CSMS: Prerequisites: Two valid idTokens with the same GroupId are configured
    Note over CS: Initial State: EVConnectedPreSession

    CS->>CSMS: 1. AuthorizeRequest
    Note right of CS: idToken.idToken: valid_idtoken2_idtoken<br/>idToken.type: valid_idtoken2_type
    CSMS-->>CS: 2. AuthorizeResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: groupIdToken

    CS->>CSMS: 3. TransactionEventRequest
    Note right of CS: triggerReason: Authorized<br/>idToken.idToken: valid_idtoken_idtoken<br/>idToken.type: valid_idtoken_type<br/>eventType: Started or Updated
    CSMS-->>CS: 4. TransactionEventResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: groupIdToken

    Note over CS: 5. Execute Reusable State: EnergyTransferStarted

    CS->>CSMS: 6. AuthorizeRequest
    Note right of CS: idToken.idToken: valid_idtoken2_idtoken<br/>idToken.type: valid_idtoken2_type
    CSMS-->>CS: 7. AuthorizeResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: groupIdToken

    CS->>CSMS: 8. TransactionEventRequest
    Note right of CS: triggerReason: StopAuthorized<br/>idToken.idToken: valid_idtoken2_idtoken<br/>idToken.type: valid_idtoken2_type<br/>eventType: Updated
    CSMS-->>CS: 9. TransactionEventResponse
    Note left of CSMS: idTokenInfo.status: Accepted<br/>idTokenInfo.groupIdToken.idToken: groupIdToken

    Note over CS: 10. Execute Reusable State: EVConnectedPostSession
    Note over CS: 11. Execute Reusable State: EVDisconnected

    Note over CS, CSMS: Tool Validations
    Note over CS, CSMS: Step 2: idTokenInfo.status=Accepted, groupIdToken.idToken=groupIdToken
    Note over CS, CSMS: Step 4: idTokenInfo.status=Accepted, groupIdToken.idToken=groupIdToken
    Note over CS, CSMS: Step 7: idTokenInfo.status=Accepted, groupIdToken.idToken=groupIdToken
    Note over CS, CSMS: Step 9: idTokenInfo.status=Accepted, groupIdToken.idToken=groupIdToken
