sequenceDiagram
    participant CS as Charging Station (OCTT)
    participant CSMS as CSMS (System Under Test)

    Note over CS,CSMS: Test Case: TC_A_04_CSMS
    Note over CS,CSMS: TLS - server-side certificate - Valid certificate
    Note over CS,CSMS: Prerequisite: CSMS supports security profile 2 and/or 3

    CS->>CSMS: 1. Initiate TLS handshake (Client Hello)
    CSMS-->>CS: 2. Server Hello with <Configured server certificate>

    Note over CS: 3. OCTT performs:<br/>Send client certificate (SP3 only)<br/>Client Key Exchange<br/>Certificate verify<br/>Change Cipher Spec<br/>Finished

    Note over CSMS: 4. CSMS performs:<br/>Change Cipher Spec<br/>Finished

    Note over CS,CSMS: TLS Handshake Complete

    Note right of CS: Tool Validation Step 3:<br/>- TLS version >= 1.2<br/>- Required cipher suites supported<br/>- Key >= 2048 bits (RSA/DSA) or >= 224 bits (ECC)<br/>- Certificate in X.509 PEM format<br/>- Certificate has serial number<br/>- commonName RDN = FQDN of server

    CS->>CSMS: 5. HTTP Upgrade Request
    Note right of CS: Note: Contains username/password<br/>only when CSMS uses security profile 2

    CSMS-->>CS: 6. Upgrade to (secured) WebSocket connection

    CS->>CSMS: 7. BootNotificationRequest (reason: PowerUp)
    CSMS-->>CS: 8. BootNotificationResponse (status: Accepted)
    Note over CSMS: Validation: status must be Accepted

    CS->>CSMS: 9. StatusNotificationRequest (connectorStatus: Available)
    CSMS-->>CS: 10. Response

    CS->>CSMS: 9. NotifyEventRequest
    Note right of CS: trigger: Delta<br/>actualValue: "Available"<br/>component.name: "Connector"<br/>variable.name: "AvailabilityState"
    CSMS-->>CS: 10. Response
